# Specify - تسجيل المستخدمين

## 1. نظرة عامة
هذا المستند يحدد المتطلبات التفصيلية لنظام تسجيل المستخدمين في تطبيق إدارة السير الذاتية.

## 2. المتطلبات الوظيفية

### FR-USER-001: تسجيل مستخدم جديد
**الوصف:** يجب أن يتمكن المستخدم من إنشاء حساب جديد.
**المدخلات:**
- الاسم الكامل (مطلوب، 2-100 حرف)
- البريد الإلكتروني (مطلوب، تنسيق صحيح)
- كلمة المرور (مطلوب، 8 أحرف على الأقل، تحتوي على حرف كبير وصغير ورقم)
- تأكيد كلمة المرور (مطابقة لكلمة المرور)

**المخرجات:**
- حساب مستخدم جديد
- تسجيل دخول تلقائي
- رسالة نجاح

**القواعد:**
- البريد الإلكتروني يجب أن يكون فريداً
- التحقق من صحة البيانات قبل الحفظ
- تشفير كلمة المرور قبل التخزين

### FR-USER-002: تسجيل الدخول
**الوصف:** يجب أن يتمكن المستخدم من تسجيل الدخول إلى حسابه.
**المدخلات:**
- البريد الإلكتروني
- كلمة المرور

**المخرجات:**
- جلسة مستخدم نشطة
- توجيه إلى صفحة الملف الشخصي

**القواعد:**
- التحقق من صحة بيانات الدخول
- تسجيل محاولات الدخول الفاشلة
- قفل الحساب بعد 5 محاولات فاشلة

### FR-USER-003: استعادة كلمة المرور
**الوصف:** يجب أن يتمكن المستخدم من استعادة كلمة المرور المنسية.
**المدخلات:**
- البريد الإلكتروني

**المخرجات:**
- رابط إعادة تعيين كلمة المرور (مستقبلاً)
- رسالة تأكيد

### FR-USER-004: عرض الملف الشخصي
**الوصف:** يجب أن يتمكن المستخدم من عرض وتعديل ملفه الشخصي.
**المدخلات:**
- بيانات الملف الشخصي (اختياري)

**المخرجات:**
- عرض بيانات الملف الشخصي
- إمكانية التعديل

## 3. المتطلبات غير الوظيفية

### NFR-USER-001: الأمان
- تشفير كلمات المرور باستخدام BCrypt
- حماية ضد هجمات CSRF
- جلسات آمنة مع انتهاء صلاحية
- تسجيل أنشطة المستخدم

### NFR-USER-002: الأداء
- وقت استجابة صفحات التسجيل < 2 ثانية
- تحميل صفحة تسجيل الدخول < 1.5 ثانية
- دعم 100 مستخدم متزامن

### NFR-USER-003: التوافق
- دعم متصفحات Chrome, Firefox, Safari, Edge
- دعم الأجهزة المحمولة والحواسيب
- دعم اللغة العربية والإنجليزية

## 4. تصميم قاعدة البيانات

### جدول Users
```sql
CREATE TABLE Users (
    Id UUID PRIMARY KEY,
    UserName VARCHAR(100) NOT NULL UNIQUE,
    Email VARCHAR(255) NOT NULL UNIQUE,
    PasswordHash VARCHAR(255) NOT NULL,
    FullName VARCHAR(100) NOT NULL,
    IsActive BOOLEAN DEFAULT TRUE,
    FailedLoginAttempts INT DEFAULT 0,
    LastLoginDate TIMESTAMP,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### جدول UserProfiles
```sql
CREATE TABLE UserProfiles (
    Id UUID PRIMARY KEY,
    UserId UUID REFERENCES Users(Id),
    PhoneNumber VARCHAR(20),
    Address TEXT,
    ProfileImageUrl VARCHAR(500),
    Bio TEXT,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 5. تصميم الواجهة الأمامية

### صفحة التسجيل (RegisterComponent)
**التصميم:**
- عنوان "إنشاء حساب جديد"
- حقول الإدخال:
  - الاسم الكامل (نص)
  - البريد الإلكتروني (بريد إلكتروني)
  - كلمة المرور (كلمة مرور)
  - تأكيد كلمة المرور (كلمة مرور)
- زر "إنشاء حساب"
- رابط "لديك حساب؟ سجل الدخول"

**التحقق من الصحة:**
- جميع الحقول مطلوبة
- تنسيق البريد الإلكتروني صحيح
- كلمة المرور 8 أحرف على الأقل
- كلمة المرور وتأكيدها متطابقتان

### صفحة تسجيل الدخول (LoginComponent)
**التصميم:**
- عنوان "تسجيل الدخول"
- حقول الإدخال:
  - البريد الإلكتروني
  - كلمة المرور
- زر "تسجيل الدخول"
- رابط "نسيت كلمة المرور؟"
- رابط "إنشاء حساب جديد"

### صفحة الملف الشخصي (ProfileComponent)
**التصميم:**
- عرض بيانات المستخدم
- إمكانية تعديل البيانات الأساسية
- قسم لإدارة الحساب

## 6. تصميم API

### نقطة النهاية: POST /api/auth/register
**الطلب:**
```json
{
  "fullName": "أحمد محمد",
  "email": "ahmed@example.com",
  "password": "Password123",
  "confirmPassword": "Password123"
}
```

**الاستجابة (النجاح):**
```json
{
  "success": true,
  "message": "تم إنشاء الحساب بنجاح",
  "data": {
    "userId": "uuid",
    "email": "ahmed@example.com",
    "fullName": "أحمد محمد",
    "token": "jwt-token"
  }
}
```

**الاستجابة (الفشل):**
```json
{
  "success": false,
  "message": "البريد الإلكتروني مستخدم مسبقاً",
  "errors": {
    "email": ["البريد الإلكتروني مستخدم مسبقاً"]
  }
}
```

### نقطة النهاية: POST /api/auth/login
**الطلب:**
```json
{
  "email": "ahmed@example.com",
  "password": "Password123"
}
```

**الاستجابة (النجاح):**
```json
{
  "success": true,
  "message": "تم تسجيل الدخول بنجاح",
  "data": {
    "userId": "uuid",
    "email": "ahmed@example.com",
    "fullName": "أحمد محمد",
    "token": "jwt-token"
  }
}
```

## 7. حالات الاستخدام

### حالة الاستخدام 1: تسجيل مستخدم جديد
1. المستخدم يزور صفحة التسجيل
2. يملأ نموذج التسجيل
3. يضغط على زر "إنشاء حساب"
4. النظام يتحقق من صحة البيانات
5. إذا كانت البيانات صحيحة:
   - ينشئ حساب المستخدم
   - يسجل دخول المستخدم تلقائياً
   - يوجه إلى صفحة الملف الشخصي
6. إذا كانت البيانات غير صحيحة:
   - يعرض رسائل الخطأ
   - يبقى في صفحة التسجيل

### حالة الاستخدام 2: تسجيل الدخول
1. المستخدم يزور صفحة تسجيل الدخول
2. يدخل بيانات الدخول
3. يضغط على زر "تسجيل الدخول"
4. النظام يتحقق من بيانات الدخول
5. إذا كانت صحيحة:
   - ينشئ جلسة للمستخدم
   - يوجه إلى صفحة الملف الشخصي
6. إذا كانت غير صحيحة:
   - يزيد عدد المحاولات الفاشلة
   - يعرض رسالة خطأ

## 8. رسائل الخطأ

| الكود | الرسالة | الوصف |
|-------|---------|-------|
| VAL-001 | "الاسم الكامل مطلوب" | حقل الاسم فارغ |
| VAL-002 | "البريد الإلكتروني مطلوب" | حقل البريد الإلكتروني فارغ |
| VAL-003 | "تنسيق البريد الإلكتروني غير صحيح" | تنسيق البريد الإلكتروني خاطئ |
| VAL-004 | "كلمة المرور مطلوبة" | حقل كلمة المرور فارغ |
| VAL-005 | "كلمة المرور يجب أن تكون 8 أحرف على الأقل" | كلمة المرور قصيرة |
| VAL-006 | "كلمة المرور وتأكيدها غير متطابقتين" | كلمتا المرور غير متطابقتين |
| AUTH-001 | "بيانات الدخول غير صحيحة" | البريد الإلكتروني أو كلمة المرور خاطئة |
| AUTH-002 | "الحساب مقفل مؤقتاً" | تجاوز عدد المحاولات الفاشلة |

## 9. الاعتبارات المستقبلية
1. إضافة التحقق من البريد الإلكتروني
2. التسجيل عبر وسائل التواصل الاجتماعي
3. المصادقة الثنائية
4. إدارة الصلاحيات المتقدمة
5. لوحة تحكم للمديرين